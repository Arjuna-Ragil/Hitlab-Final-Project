<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Home Page</title>
    <link rel="icon" type="image/x-icon" href="/favicon (1).ico" />
    <style>
      input::-webkit-outer-spin-button,
      input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }

      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f4f4;
      }

      .container {
        width: 100%;
        height: 100%;
        background-color: #ff8500;
      }

      .header {
        display: grid;
        margin-bottom: 20px;
      }

      .logo {
        background-color: white;
        border-radius: 20px;
        width: 200px;
        margin-top: 5px;
        grid-column: 1/2;
        grid-row: 1/2;
        align-self: center;
        justify-self: center;
      }

      .search-bar {
        display: flex;
        align-items: center;
        justify-self: center;
        grid-column: 3/5;
        grid-row: 1/2;
      }

      .search-input {
        width: 200px;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
      }

      #logoutContainer {
        width: 50px;
        height: 50px;
        align-self: center;
        justify-self: center;
        grid-column: 5/7;
        grid-row: 1/2;
      }

      #logoutButton {
        width: 50px;
        height: 50px;
      }

      .content {
        display: flex;
      }

      .left-column {
        width: 30%;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 5px;
        background-color: white;
      }

      .right-column {
        width: 65%;
        padding: 20px;
        border: 1px solid #ccc;
        background-color: white;
        border-radius: 5px;
      }

      .job-listings {
        margin-top: 20px;
      }

      .job-listing {
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
        margin-bottom: 10px;
        background-color: #fff;
      }

      .footer {
        text-align: center;
        margin-top: 20px;
        font-size: 12px;
        color: black;
      }

      #searchbar {
        margin: 10px;
        padding: 10px;
        border-radius: 5px;
        width: 50%;
        box-sizing: border-box;
      }

      #list {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .job {
        font-size: 1.2em;
        padding: 10px;
        border-bottom: 1px solid #ccc;
        animation: fadeIn 0.5s ease-in-out;
      }

      .job:last-child {
        border-bottom: none;
      }

      .hide {
        display: none;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div class="logo">
          <img src="/image/logo and text.png" alt="error" width="150px" />
        </div>
        <form id="logoutContainer" action="/logOut?_method=DELETE" method="POST">
          <button id="logoutButton" type="submit">logout</button>
        </form>
        <div class="search-bar">
        <input
          type="text"
          class="search-input"
          placeholder="Search jobs..."
          data-search
        />
      </div> 
      </div>
      <div class="content">
        <div class="left-column">
          <h3>Profile</h3>
          <ul>
            <li>Nama:</li>
            <li>Moto Profesional:</li>
            <li>Kota:</li>
            <li>Pendidikan:</li>
          </ul>
        </div>
        <div class="right-column">
          <h2>Job Listings</h2>
          <div class="job-listings"></div>
          <form id="jobForm">
            <input
              type="text"
              id="jobInput"
              placeholder="Nama Perusahaan"
              required
            />
            <input
              type="text"
              id="jobDescription"
              placeholder="Posisi Pekerjaan"
              required
            />
            <input type="number" id="jobSalary" placeholder="Gaji" required />
            <button type="submit">Add</button>
          </form>
          <div class="job-listings" id="jobListings"></div>
        </div>
      </div>
    </div>
    <script>
      const API_URL = "http://localhost:5000/api/jobs";
      const jobForm = document.getElementById("jobForm");
      const jobListings = document.getElementById("jobListings");

      // Fungsi untuk memuat pekerjaan dari backend
      async function loadJobs() {
        const response = await fetch(API_URL);
        const jobs = await response.json();
        jobListings.innerHTML = ""; // Kosongkan daftar sebelumnya
        jobs.forEach((job) => addJobToDOM(job));
      }

      // Fungsi untuk menampilkan pekerjaan di DOM
      function addJobToDOM(job) {
        const jobDiv = document.createElement("div");
        jobDiv.className = "job-listing";
        jobDiv.dataset.id = job.id;

        jobDiv.innerHTML = `
        <p> <b> Nama Perusahaan: </b> ${job.title}</p>
        <p> <b> Deskripsi Pekerjaan: </b> <br> <br>${job.description}</p>
        <p> <b> Gaji: </b> Rp.${job.salary}</p>
        <button onclick="deleteJob(${job.id})">Delete</button>
        <button onclick="applyJob(${job.id})">Apply</button>
         `;

        jobListings.appendChild(jobDiv);
        return {
          title: job.title,
          description: job.description,
          element: jobDiv,
        };
      }

      // Fungsi untuk menambahkan pekerjaan
      jobForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        const title = document.getElementById("jobInput").value;
        const description = document.getElementById("jobDescription").value;
        const salary = document.getElementById("jobSalary").value;

        const response = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ title, description, salary }),
        });

        if (response.ok) {
          const newJob = await response.json();
          addJobToDOM(newJob); // Tambahkan ke UI
          jobForm.reset();
        } else {
          alert("Failed to add job!");
        }
      });

      // Fungsi untuk menghapus pekerjaan
      async function deleteJob(id) {
        const response = await fetch(`${API_URL}/${id}`, { method: "DELETE" });
        if (response.ok) {
          document.querySelector(`.job-listing[data-id="${id}"]`).remove();
        } else {
          alert("Failed to delete job!");
        }
      }

      // Muat data awal
      loadJobs();

      //form apply
      function applyJob(id) {
        location.href = `http://localhost:5000/JobQues/Apply/${id}`
      }

      //search bar
      const searchInput = document.querySelector("[data-search]");

      searchInput.addEventListener("input", async (e) => {
        const response = await fetch(API_URL);
        const jobs = await response.json();
        const value = e.target.value.toLowerCase();
        
        jobs.forEach((job) => {
          const isVisible = job.title.toLowerCase().includes(value) || job.description.toLowerCase().includes(value);
          const jobElement = document.querySelector(`.job-listing[data-id="${job.id}"]`);
          if (jobElement) {
            jobElement.classList.toggle("hide", !isVisible);
          }
        });
      });
    </script>
  </body>
</html>
